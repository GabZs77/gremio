<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chat de Sugest√µes do Gr√™mio</title>
  <style>
    * {margin:0; padding:0; box-sizing:border-box;}
    body {font-family: Arial,sans-serif; background:#ece5dd;}
    .chat-container {
      max-width: 600px;
      margin: 50px auto;
      height: 90vh;
      display: flex;
      flex-direction: column;
      border-radius: 8px;
      background: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .header {
      background: #075e54;
      color: white;
      padding: 15px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select:none;
    }
    .header .buttons {
      display: flex;
      gap: 10px;
    }
    button {
      cursor: pointer;
      border: none;
      border-radius: 4px;
      padding: 6px 12px;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    button#loginAdmBtn {
      background: #128c7e;
      color: white;
    }
    button#logoutAdmBtn {
      background: #f44336;
      color: white;
      display: none;
    }
    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      background: #e5ddd5;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .message {
      max-width: 75%;
      background: #dcf8c6;
      padding: 10px 15px;
      border-radius: 10px;
      position: relative;
      font-size: 14px;
      word-break: break-word;
    }
    .message.adm {
      background: #bee1ff;
    }
    .message .adm-tag {
      position: absolute;
      top: -14px;
      right: 10px;
      background: #2196f3;
      color: white;
      padding: 2px 6px;
      font-size: 10px;
      border-radius: 4px;
      user-select:none;
    }
    .message .time {
      display: block;
      font-size: 10px;
      color: #555;
      margin-top: 5px;
      text-align: right;
    }
    .message button.delete-btn {
      position: absolute;
      bottom: 6px;
      left: 10px;
      background: #f44336;
      border-radius: 4px;
      padding: 2px 6px;
      font-size: 12px;
      color: white;
      cursor: pointer;
    }
    .input-area {
      display: flex;
      border-top: 1px solid #ccc;
      padding: 10px;
    }
    #messageInput {
      flex: 1;
      padding: 10px;
      font-size: 16px;
      border-radius: 4px;
      border: 1px solid #ccc;
      outline: none;
    }
    #sendBtn {
      background: #075e54;
      color: white;
      border: none;
      padding: 0 20px;
      margin-left: 10px;
      border-radius: 4px;
      font-weight: bold;
    }
    #loginModal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 25px 30px 30px 30px;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
      z-index: 9999;
      width: 320px;
    }
    #loginModal h3 {
      margin-bottom: 15px;
      user-select:none;
    }
    #loginModal input {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    #loginModal button {
      width: 100%;
      padding: 10px;
      background: #128c7e;
      color: white;
      font-weight: bold;
    }
    #closeModalBtn {
      position: absolute;
      right: 15px;
      top: 12px;
      font-size: 20px;
      font-weight: bold;
      color: #888;
      background: transparent;
      border: none;
      cursor: pointer;
      user-select:none;
    }
    #modalOverlay {
      position: fixed;
      top: 0;
      left: 0;
      right:0;
      bottom:0;
      background: rgba(0,0,0,0.3);
      z-index: 9998;
      display: none;
    }
  </style>
</head>
<body>
<div class="chat-container">
  <div class="header">
    Gr√™mio For√ßa Jovem - E.E. Sebasti√£o Vila√ßa
    <div class="buttons">
      <button id="loginAdmBtn">Login ADM</button>
      <button id="logoutAdmBtn">Sair ADM</button>
    </div>
  </div>
  <div class="messages" id="messages"></div>
  <div class="input-area">
    <input id="messageInput" placeholder="Digite sua sugest√£o... üòä" autocomplete="off" />
    <button id="sendBtn">Enviar</button>
  </div>
</div>
<div id="modalOverlay"></div>
<div id="loginModal">
  <button id="closeModalBtn">√ó</button>
  <h3>Login ADM</h3>
  <input id="admUser" type="text" placeholder="Usu√°rio" />
  <input id="admPass" type="password" placeholder="Senha" />
  <button id="admLoginBtn">Entrar</button>
</div>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyD8HpvX2scRrV2Yhh_V8B3QMZIRwyR8gak",
    authDomain: "chatanonimo-d1676.firebaseapp.com",
    databaseURL: "https://chatanonimo-d1676-default-rtdb.firebaseio.com",
    projectId: "chatanonimo-d1676",
    storageBucket: "chatanonimo-d1676.appspot.com",
    messagingSenderId: "951790566544",
    appId: "1:951790566544:web:4687d205d4673be5636c15"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const adms = { "Paran√°": "02062010", "Gabriel": "02062010" };
  let loggedADMs = [];
  let userName = "";
  // Solicita nome
  window.onload = () => {
    setTimeout(() => {
      const nome = prompt("Coloque seu nome (ou deixe em branco para an√¥nimo):");
      userName = nome && nome.trim() !== "" ? nome.trim() : "An√¥nimo";
    }, 200);
  };
  const messagesDiv = document.getElementById("messages");
  const messageInput = document.getElementById("messageInput");
  const sendBtn = document.getElementById("sendBtn");
  const loginAdmBtn = document.getElementById("loginAdmBtn");
  const logoutAdmBtn = document.getElementById("logoutAdmBtn");
  const loginModal = document.getElementById("loginModal");
  const modalOverlay = document.getElementById("modalOverlay");
  const closeModalBtn = document.getElementById("closeModalBtn");
  const admUserInput = document.getElementById("admUser");
  const admPassInput = document.getElementById("admPass");
  const admLoginBtn = document.getElementById("admLoginBtn");
  loginAdmBtn.onclick = () => {
    loginModal.style.display = "block";
    modalOverlay.style.display = "block";
  };
  closeModalBtn.onclick = modalOverlay.onclick = () => {
    loginModal.style.display = "none";
    modalOverlay.style.display = "none";
    admUserInput.value = "";
    admPassInput.value = "";
  };
  admLoginBtn.onclick = () => {
    const user = admUserInput.value.trim();
    const pass = admPassInput.value;
    if (adms[user] && adms[user] === pass) {
      if (!loggedADMs.includes(user)) loggedADMs.push(user);
      userName = user;
      updateAdminButtons();
      alert(`Voc√™ fez login como ${user}`);
      closeModalBtn.click();
    } else {
      alert("Usu√°rio ou senha incorretos.");
    }
  };
  logoutAdmBtn.onclick = () => {
  loggedADMs = loggedADMs.filter(adm => adm !== userName);
  userName = "An√¥nimo";
  updateAdminButtons();
  alert("Voc√™ saiu do modo ADM.");
  // Recarrega as mensagens para remover bot√µes
  db.ref("mensagens").once("value", () => {});
};
  function updateAdminButtons() {
    loginAdmBtn.style.display = loggedADMs.length > 0 ? "none" : "inline-block";
    logoutAdmBtn.style.display = loggedADMs.length > 0 ? "inline-block" : "none";
  }
  sendBtn.onclick = enviarMensagem;
  messageInput.addEventListener("keydown", e => {
    if (e.key === "Enter") enviarMensagem();
  });
  function contemPalavroes(texto) {
    const palavrasProibidas = ["Desgra√ßa", "Caralho", "Filho da puta", "Vagabundo", "Desgra√ßado", "Desgra√ßada", "fdp", "pqp", "vsfd", "carai", "merda", "bosta" "mrd", "bst", "cu", "bct", "buceta" , "Buceta", "Bct", "BCT"];
    const textoLimpo = texto.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^\w\s]/g, "");
    return palavrasProibidas.some(p => textoLimpo.includes(p));
  }
  function enviarMensagem() {
    const texto = messageInput.value.trim();
    if (!texto) return;
    if (contemPalavroes(texto)) {
      alert("Evite palavr√µes, por favor.");
      return;
    }
    const horario = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    db.ref("mensagens").push({
      nome: userName,
      texto,
      adm: loggedADMs.includes(userName),
      horario,
      timestamp: Date.now()
    });
    messageInput.value = "";
  }
  db.ref("mensagens").orderByChild("timestamp").on("value", snapshot => {
    messagesDiv.innerHTML = "";
    snapshot.forEach(child => {
      const msg = child.val();
      const key = child.key;
      const div = document.createElement("div");
      div.className = "message";
      if (msg.adm) div.classList.add("adm");
      if (msg.adm) {
        const tag = document.createElement("div");
        tag.className = "adm-tag";
        tag.textContent = "ADM";
        div.appendChild(tag);
      }
      div.innerHTML += `<strong>${escapeHTML(msg.nome)}</strong>: ${escapeHTML(msg.texto)}`;
      div.innerHTML += `<span class="time">${msg.horario}</span>`;
      
      // Mostra o bot√£o de apagar apenas para administradores (incluindo mensagens pr√≥prias)
      if (adms[userName] && loggedADMs.includes(userName)) {
  const delBtn = document.createElement("button");
  delBtn.className = "delete-btn";
  delBtn.textContent = "Apagar";
  delBtn.onclick = () => {
    if (confirm("Quer mesmo apagar essa mensagem?")) {
      db.ref("mensagens/" + key).remove();
    }
  };
  div.appendChild(delBtn);
}
      
      messagesDiv.appendChild(div);
    });
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });
  function escapeHTML(str) {
    return str.replace(/[&<>"']/g, m => ({ '&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;' }[m]));
  }
</script>
</body>
</html>
