<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat de Sugestões do Grêmio</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #e8f0fe;
      margin: 0;
      padding: 0;
    }
    header {
      background: #0b57d0;
      color: white;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .chat-container {
      max-width: 600px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
    }
    .message {
      background: #f1f1f1;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
      position: relative;
    }
    .delete-btn {
      position: absolute;
      right: 10px;
      top: 10px;
      background: red;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
    }
    #loginModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.4);
      display: flex;
      justify-content: center;
      align-items: center;
      display: none;
    }
    #loginModal.active {
      display: flex;
    }
    .login-box {
      background: white;
      padding: 20px;
      border-radius: 8px;
    }
    #loginBtn {
      cursor: pointer;
      background: #0b57d0;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 5px;
    }
    textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>

<header>
  <h2>Chat de Sugestões do Grêmio</h2>
  <button id="openLogin" style="padding: 10px;">Login</button>
</header>

<div class="chat-container">
  <div id="messages"></div>
  <textarea id="messageInput" placeholder="Digite sua sugestão..."></textarea>
  <button onclick="sendMessage()">Enviar</button>
</div>

<div id="loginModal">
  <div class="login-box">
    <h3>Login</h3>
    <input type="text" id="username" placeholder="Usuário"><br><br>
    <input type="password" id="password" placeholder="Senha"><br><br>
    <button onclick="doLogin()">Entrar</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD8HpvX2scRrV2Yhh_V8B3QMZIRwyR8gak",
    authDomain: "chatanonimo-d1676.firebaseapp.com",
    databaseURL: "https://chatanonimo-d1676-default-rtdb.firebaseio.com",
    projectId: "chatanonimo-d1676",
    storageBucket: "chatanonimo-d1676.appspot.com",
    messagingSenderId: "951790566544",
    appId: "1:951790566544:web:4687d205d4673be5636c15",
    measurementId: "G-XGGHD7E1TB"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const messagesRef = ref(db, "messages");

  const isAdmin = () => localStorage.getItem("logged") === "true";

  const blockedWords = [
    "puta", "puto", "fdp", "caralho", "carai", "porra", "bosta", "merda", "desgraça",
    "cacete", "arrombado", "pqp", "foda", "fodase", "foda-se", "cu", "buceta", "vadia",
    "vagabunda", "viado", "boiola", "corno", "safado", "safada", "bixa", "trouxa", "otário",
    "otaria", "piranha", "escroto", "escrota", "cuzão", "babaca", "pau no cu", "pau no seu cu",
    "krl", "krlh", "crlh", "vsf", "vtnc", "vai se fuder", "vai tomar no cu", "c@ralho", "c@r@lho", "caralhooo",
    "fud3r", "fudido", "fudida", "p0rra", "poha", "kct", "k7", "fudido", "fudida", "f*dido", "f*dida", "cacet*"
  ];

  const sanitize = (text) => {
    const norm = text.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    for (let word of blockedWords) {
      const pattern = new RegExp(`\\b${word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\b`, "gi");
      if (pattern.test(norm)) return true;
    }
    return false;
  };

  function sendMessage() {
    const input = document.getElementById("messageInput");
    const message = input.value.trim();
    if (!message) return;
    if (sanitize(message)) {
      alert("Mensagem contém palavras inadequadas.");
      return;
    }
    push(messagesRef, { text: message });
    input.value = "";
  }

  function renderMessage(key, text) {
    const container = document.getElementById("messages");
    const msgDiv = document.createElement("div");
    msgDiv.className = "message";
    msgDiv.id = key;
    msgDiv.textContent = text;

    if (isAdmin()) {
      const del = document.createElement("button");
      del.textContent = "Apagar";
      del.className = "delete-btn";
      del.onclick = () => {
        if (confirm("Apagar essa mensagem para todos?")) {
          remove(ref(db, `messages/${key}`));
        }
      };
      msgDiv.appendChild(del);
    }

    container.appendChild(msgDiv);
  }

  onChildAdded(messagesRef, (data) => {
    const { text } = data.val();
    renderMessage(data.key, text);
  });

  function doLogin() {
    const u = document.getElementById("username").value;
    const p = document.getElementById("password").value;
    if (u === "gremio" && p === "02062010") {
      localStorage.setItem("logged", "true");
      alert("Logado com sucesso.");
      location.reload();
    } else {
      alert("Usuário ou senha incorretos.");
    }
  }

  document.getElementById("openLogin").onclick = () => {
    document.getElementById("loginModal").classList.add("active");
  };
</script>

</body>
</html>
